{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2026-02-06 17:47:25.672989",
 "css": "@page {\r\n  size: A4 landscape;\r\n  margin: 10mm;\r\n}\r\n\r\n.print-format {\r\n  font-size: 10px;\r\n  line-height: 1.25;\r\n}\r\n\r\n.so-pf-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  gap: 12px;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.so-pf-title {\r\n  font-size: 14px;\r\n  font-weight: 700;\r\n}\r\n\r\n.so-pf-meta {\r\n  font-size: 10px;\r\n  opacity: 0.9;\r\n  text-align: right;\r\n}\r\n\r\n.so-pf-group {\r\n  margin: 0 0 10px 0;\r\n  break-inside: avoid;\r\n  page-break-inside: avoid;\r\n}\r\n\r\n.so-pf-group-name {\r\n  font-size: 12px;\r\n  font-weight: 700;\r\n  margin: 0 0 6px 0;\r\n}\r\n\r\n.so-pf-table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  table-layout: fixed;\r\n}\r\n\r\n.so-pf-table th,\r\n.so-pf-table td {\r\n  border: 1px solid #999;\r\n  padding: 4px 6px;\r\n  vertical-align: top;\r\n  word-wrap: break-word;\r\n}\r\n\r\n.so-pf-table th {\r\n  font-weight: 700;\r\n}\r\n\r\n.so-pf-col-left {\r\n  width: 22%;\r\n}\r\n\r\n.so-pf-col-shift {\r\n  width: auto;\r\n}\r\n\r\n.so-pf-empty {\r\n  color: #666;\r\n  font-style: italic;\r\n}\r\n\r\n.so-pf-badge {\r\n  display: inline-block;\r\n  padding: 1px 6px;\r\n  border: 1px solid #999;\r\n  border-radius: 999px;\r\n  font-size: 9px;\r\n  margin-left: 6px;\r\n}\r\n\r\n.so-pf-lists {\r\n  margin-top: 14px;\r\n  display: flex;\r\n  gap: 16px;\r\n}\r\n\r\n.so-pf-list {\r\n  width: 50%;\r\n  break-inside: avoid;\r\n  page-break-inside: avoid;\r\n}\r\n\r\n.so-pf-list h3 {\r\n  font-size: 11px;\r\n  font-weight: 700;\r\n  margin: 0 0 6px 0;\r\n}\r\n\r\n.so-pf-list ul {\r\n  margin: 0;\r\n  padding-left: 16px;\r\n}\r\n\r\n.so-pf-list li {\r\n  margin: 0 0 3px 0;\r\n}\r\n",
 "custom_format": 0,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Site Organogram",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "format_data": "[{\"fieldname\": \"print_heading_template\", \"fieldtype\": \"Custom HTML\", \"options\": \"<div class=\\\"print-heading\\\">\\t\\t\\t\\t<h2><div>Site Organogram</div><br><small class=\\\"sub-heading\\\">{{ _(doc.name) }}</small>\\t\\t\\t\\t</h2></div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{# =========================\\r\\n   Helpers\\r\\n   ========================= #}\\r\\n\\r\\n{% set shift_letters = [\\\"A\\\",\\\"B\\\",\\\"C\\\",\\\"D\\\",\\\"E\\\"] %}\\r\\n\\r\\n{% set n = (doc.shifts or 0) | int %}\\r\\n{% if n < 0 %}{% set n = 0 %}{% endif %}\\r\\n{% if n > 5 %}{% set n = 5 %}{% endif %}\\r\\n\\r\\n{% set active_shifts = [] %}\\r\\n{% for i in range(n) %}\\r\\n  {% set _ = active_shifts.append(\\\"Shift \\\" ~ shift_letters[i]) %}\\r\\n{% endfor %}\\r\\n\\r\\n{# Build lookups for employees/assets from the child tables #}\\r\\n{% set emp_by_id = {} %}\\r\\n{% for e in (doc.employees or []) %}\\r\\n  {% if e.employee %}\\r\\n    {% set _ = emp_by_id.update({ e.employee: e }) %}\\r\\n  {% endif %}\\r\\n{% endfor %}\\r\\n\\r\\n{% set asset_by_id = {} %}\\r\\n{% for a in (doc.assets or []) %}\\r\\n  {% if a.asset %}\\r\\n    {% set _ = asset_by_id.update({ a.asset: a }) %}\\r\\n  {% endif %}\\r\\n{% endfor %}\\r\\n\\r\\n{# Assigned employees = any mapping row with employee set #}\\r\\n{% set assigned_employees = [] %}\\r\\n{% for m in (doc.shift_mappings or []) %}\\r\\n  {% if m.employee and (m.employee not in assigned_employees) %}\\r\\n    {% set _ = assigned_employees.append(m.employee) %}\\r\\n  {% endif %}\\r\\n{% endfor %}\\r\\n\\r\\n{# Unallocated employees = in employees table, but not assigned #}\\r\\n{% set unallocated_employees = [] %}\\r\\n{% for e in (doc.employees or []) %}\\r\\n  {% if e.employee and (e.employee not in assigned_employees) %}\\r\\n    {% set _ = unallocated_employees.append(e) %}\\r\\n  {% endif %}\\r\\n{% endfor %}\\r\\n\\r\\n{# Allocated assets = any mapping row that represents an asset row_key or has asset set #}\\r\\n{% set allocated_assets = [] %}\\r\\n{% for m in (doc.shift_mappings or []) %}\\r\\n  {% if m.asset and (m.asset not in allocated_assets) %}\\r\\n    {% set _ = allocated_assets.append(m.asset) %}\\r\\n  {% endif %}\\r\\n  {% if m.row_key and m.row_key.startswith(\\\"ASSET::\\\") %}\\r\\n    {% set a_id = m.row_key.replace(\\\"ASSET::\\\", \\\"\\\") %}\\r\\n    {% if a_id and (a_id not in allocated_assets) %}\\r\\n      {% set _ = allocated_assets.append(a_id) %}\\r\\n    {% endif %}\\r\\n  {% endif %}\\r\\n{% endfor %}\\r\\n\\r\\n{# Unallocated assets = in assets table, but not allocated_assets #}\\r\\n{% set unallocated_assets = [] %}\\r\\n{% for a in (doc.assets or []) %}\\r\\n  {% if a.asset and (a.asset not in allocated_assets) %}\\r\\n    {% set _ = unallocated_assets.append(a) %}\\r\\n  {% endif %}\\r\\n{% endfor %}\\r\\n\\r\\n<div class=\\\"so-pf-header\\\">\\r\\n  <div>\\r\\n    <div class=\\\"so-pf-title\\\">Site Organogram</div>\\r\\n    <div class=\\\"so-pf-meta\\\">\\r\\n      {% if doc.branch %}<div><b>Branch:</b> {{ doc.branch }}</div>{% endif %}\\r\\n      {% if doc.location %}<div><b>Location:</b> {{ doc.location }}</div>{% endif %}\\r\\n    </div>\\r\\n  </div>\\r\\n\\r\\n  <div class=\\\"so-pf-meta\\\">\\r\\n    <div><b>Document:</b> {{ doc.name }}</div>\\r\\n    <div><b>Printed:</b> {{ frappe.utils.now_datetime().strftime(\\\"%Y-%m-%d %H:%M\\\") }}</div>\\r\\n  </div>\\r\\n</div>\\r\\n\\r\\n{# =========================\\r\\n   Groups\\r\\n   ========================= #}\\r\\n\\r\\n{% for g in (doc.group_headings or []) %}\\r\\n  {% if not g.group %}{% continue %}{% endif %}\\r\\n\\r\\n  {# Determine shifts for this group (mirrors your JS logic) #}\\r\\n  {% set mode = (g.shifts or \\\"\\\").strip() %}\\r\\n  {% if mode == \\\"Day Shift Only\\\" %}\\r\\n    {% set group_shifts = [\\\"Day Shift\\\"] %}\\r\\n  {% elif mode == \\\"Night Shift Only\\\" %}\\r\\n    {% set group_shifts = [\\\"Night Shift\\\"] %}\\r\\n  {% else %}\\r\\n    {% set group_shifts = active_shifts %}\\r\\n  {% endif %}\\r\\n\\r\\n  {# Collect unique row_keys for this group #}\\r\\n  {% set row_keys = [] %}\\r\\n  {% for m in (doc.shift_mappings or []) %}\\r\\n    {% if (m.group or \\\"\\\") == g.group and m.row_key and (m.row_key not in row_keys) %}\\r\\n      {% set _ = row_keys.append(m.row_key) %}\\r\\n    {% endif %}\\r\\n  {% endfor %}\\r\\n\\r\\n  {# Sort rows: assets first, then designations, each alphabetical by the label #}\\r\\n  {% set asset_rows = [] %}\\r\\n  {% set desig_rows = [] %}\\r\\n\\r\\n  {% for rk in row_keys %}\\r\\n    {% if rk.startswith(\\\"ASSET::\\\") %}\\r\\n      {% set _ = asset_rows.append(rk) %}\\r\\n    {% elif rk.startswith(\\\"DESIG::\\\") %}\\r\\n      {% set _ = desig_rows.append(rk) %}\\r\\n    {% else %}\\r\\n      {# unknown row types (if any) treat as designations #}\\r\\n      {% set _ = desig_rows.append(rk) %}\\r\\n    {% endif %}\\r\\n  {% endfor %}\\r\\n\\r\\n  {% set asset_rows = asset_rows | sort %}\\r\\n  {% set desig_rows = desig_rows | sort %}\\r\\n\\r\\n  <div class=\\\"so-pf-group\\\">\\r\\n    <div class=\\\"so-pf-group-name\\\">{{ g.group }} {% if g.shifts %}<span class=\\\"so-pf-badge\\\">{{ g.shifts }}</span>{% endif %}</div>\\r\\n\\r\\n    <table class=\\\"so-pf-table\\\">\\r\\n      <thead>\\r\\n        <tr>\\r\\n          <th class=\\\"so-pf-col-left\\\">Asset / Designation</th>\\r\\n          {% for s in group_shifts %}\\r\\n            <th class=\\\"so-pf-col-shift\\\">{{ s }}</th>\\r\\n          {% endfor %}\\r\\n        </tr>\\r\\n      </thead>\\r\\n\\r\\n      <tbody>\\r\\n        {% set ordered_rows = asset_rows + desig_rows %}\\r\\n\\r\\n        {% if not ordered_rows %}\\r\\n          <tr>\\r\\n            <td colspan=\\\"{{ 1 + (group_shifts | length) }}\\\" class=\\\"so-pf-empty\\\">No rows in this group.</td>\\r\\n          </tr>\\r\\n        {% else %}\\r\\n\\r\\n          {% for rk in ordered_rows %}\\r\\n            <tr>\\r\\n              <td>\\r\\n                {% if rk.startswith(\\\"ASSET::\\\") %}\\r\\n                  {% set a_id = rk.replace(\\\"ASSET::\\\",\\\"\\\") %}\\r\\n                  {% set a = asset_by_id.get(a_id) %}\\r\\n                  {% if a %}\\r\\n                    <b>{{ a.asset }}</b>{% if a.item_name %} \\u2014 {{ a.item_name }}{% endif %}\\r\\n                    {% if a.asset_category %}<div class=\\\"so-pf-empty\\\">{{ a.asset_category }}</div>{% endif %}\\r\\n                  {% else %}\\r\\n                    <b>{{ a_id }}</b>\\r\\n                  {% endif %}\\r\\n                {% elif rk.startswith(\\\"DESIG::\\\") %}\\r\\n                  {% set d = rk.replace(\\\"DESIG::\\\",\\\"\\\") %}\\r\\n                  <b>{{ d }}</b>\\r\\n                {% else %}\\r\\n                  <b>{{ rk }}</b>\\r\\n                {% endif %}\\r\\n              </td>\\r\\n\\r\\n              {# Each shift cell: find mapping row for group+shift+row_key #}\\r\\n              {% for s in group_shifts %}\\r\\n                {% set cell_emp = None %}\\r\\n                {% for m in (doc.shift_mappings or []) %}\\r\\n                  {% if (m.group or \\\"\\\") == g.group and (m.shift or \\\"\\\") == s and (m.row_key or \\\"\\\") == rk %}\\r\\n                    {% if m.employee %}\\r\\n                      {% set cell_emp = emp_by_id.get(m.employee) %}\\r\\n                    {% endif %}\\r\\n                    {% break %}\\r\\n                  {% endif %}\\r\\n                {% endfor %}\\r\\n\\r\\n                <td>\\r\\n                  {% if cell_emp %}\\r\\n                    <b>{{ cell_emp.employee_name or cell_emp.employee }}</b>\\r\\n                    {% if cell_emp.employee %} ({{ cell_emp.employee }}){% endif %}\\r\\n                    {% if cell_emp.designation %}<div class=\\\"so-pf-empty\\\">{{ cell_emp.designation }}</div>{% endif %}\\r\\n                  {% else %}\\r\\n                    <span class=\\\"so-pf-empty\\\">\\u2014</span>\\r\\n                  {% endif %}\\r\\n                </td>\\r\\n              {% endfor %}\\r\\n            </tr>\\r\\n          {% endfor %}\\r\\n\\r\\n        {% endif %}\\r\\n      </tbody>\\r\\n    </table>\\r\\n  </div>\\r\\n{% endfor %}\\r\\n\\r\\n{# =========================\\r\\n   Bottom lists\\r\\n   ========================= #}\\r\\n\\r\\n<div class=\\\"so-pf-lists\\\">\\r\\n  <div class=\\\"so-pf-list\\\">\\r\\n    <h3>Unallocated Employees</h3>\\r\\n    {% if unallocated_employees %}\\r\\n      <ul>\\r\\n        {% for e in unallocated_employees | sort(attribute=\\\"employee_name\\\") %}\\r\\n          <li>\\r\\n            <b>{{ e.employee_name or e.employee }}</b>{% if e.employee %} ({{ e.employee }}){% endif %}\\r\\n            {% if e.designation %} \\u2014 <span class=\\\"so-pf-empty\\\">{{ e.designation }}</span>{% endif %}\\r\\n          </li>\\r\\n        {% endfor %}\\r\\n      </ul>\\r\\n    {% else %}\\r\\n      <div class=\\\"so-pf-empty\\\">None</div>\\r\\n    {% endif %}\\r\\n  </div>\\r\\n\\r\\n  <div class=\\\"so-pf-list\\\">\\r\\n    <h3>Unallocated Assets</h3>\\r\\n    {% if unallocated_assets %}\\r\\n      <ul>\\r\\n        {% for a in unallocated_assets | sort(attribute=\\\"asset\\\") %}\\r\\n          <li>\\r\\n            <b>{{ a.asset }}</b>\\r\\n            {% if a.item_name %} \\u2014 <span class=\\\"so-pf-empty\\\">{{ a.item_name }}</span>{% endif %}\\r\\n            {% if a.asset_category %} \\u2014 <span class=\\\"so-pf-empty\\\">{{ a.asset_category }}</span>{% endif %}\\r\\n          </li>\\r\\n        {% endfor %}\\r\\n      </ul>\\r\\n    {% else %}\\r\\n      <div class=\\\"so-pf-empty\\\">None</div>\\r\\n    {% endif %}\\r\\n  </div>\\r\\n</div>\\r\\n\"}]",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2026-02-06 17:47:55.380901",
 "modified_by": "Administrator",
 "module": "Industrial Relations",
 "name": "Site Organogram",
 "owner": "Administrator",
 "page_number": "Hide",
 "pdf_generator": "wkhtmltopdf",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_for": "DocType",
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}
